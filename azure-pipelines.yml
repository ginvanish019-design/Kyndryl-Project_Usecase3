# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  branches:
    include:
      - main

pool:
  name: 'Anish_Agent'

steps:
- checkout: self

# Install Python if missing (works for Ubuntu/Debian-based self-hosted agents)
- script: |
    echo "ğŸ Checking Python installation..."
    if ! command -v python3 &> /dev/null
    then
        echo "âš™ï¸ Installing Python..."
        sudo apt update
        sudo apt install -y python3 python3-pip
        sudo ln -sf /usr/bin/python3 /usr/local/bin/python
        sudo ln -sf /usr/bin/pip3 /usr/local/bin/pip
    else
        echo "âœ… Python already installed"
    fi

    python --version
    pip --version
  displayName: "Install Python (if not already installed)"

# Install dependencies and run your multi-cloud script
- script: |
    echo "ğŸš€ Installing dependencies..."
    pip install --upgrade pip
    pip install boto3 azure-identity azure-mgmt-compute google-cloud-compute google-auth

    echo "ğŸŒ Running Multi-Cloud Auto Manager..."
    python multi_cloud_auto_manager.py
  displayName: "Run Multi-Cloud Auto Manager"
