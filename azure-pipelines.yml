# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  branches:
    include:
      - main

pool:
  name: 'Anish_Agent'

steps:
- checkout: self

# Step 1: Install Python if not available
- script: |
    echo "ğŸ Checking if Python3 is installed..."
    if ! command -v python3 &> /dev/null
    then
        echo "âš™ï¸ Installing Python3 and pip..."
        sudo apt-get update -y
        sudo apt-get install -y python3 python3-pip
    else
        echo "âœ… Python3 is already installed."
    fi

    # Create symlinks to ensure 'python' and 'pip' commands work
    if ! command -v python &> /dev/null
    then
        sudo ln -s $(which python3) /usr/local/bin/python
    fi

    if ! command -v pip &> /dev/null
    then
        sudo ln -s $(which pip3) /usr/local/bin/pip
    fi

    echo "Python path: $(which python)"
    python --version
    pip --version
  displayName: "Install Python (if needed)"

# Step 2: Install dependencies and run the multi-cloud script
- script: |
    echo "ğŸš€ Installing dependencies..."
    pip install --upgrade pip
    pip install boto3 azure-identity azure-mgmt-compute google-cloud-compute google-auth

    echo "ğŸŒ Running Multi-Cloud Auto Manager..."
    python multi_cloud_auto_manager.py
  displayName: "Run Multi-Cloud Auto Manager"
